<!-- <?php
    
    require 'db_connect.php';
	require 'functions.php';
	//require_once __DIR__ . '/src/Facebook/autoload.php';
	require 'facebook_login/php-graph-sdk-5.x/src/Facebook/autoload.php';
    
	session_start();
	if (!empty($_SESSION['alcher_id'])) {
        
        header('Location: ../caportal/dashboard.php');
        
    }
    
	if(isset($_POST['create_account'])){
	    
		//server side validation of inputs
		
		$fullname= test_input($_POST['fullname']);
		$email= test_input($_POST['email']);
		$phone= test_input($_POST['phone']);

		$gender= (isset($_POST['gender']) ? $_POST['gender'] : null);

		$team_name= test_input($_POST['team_name']);
		$interests= (isset($_POST['interests']) ? $_POST['interests'] : null);

		$password= $_POST['password'];
		$password= stripslashes($password);
		$password= htmlspecialchars($password, ENT_QUOTES);
        
		//error reporting
		
		$fullname_error= $email_error= $phone_error= $gender_error= $team_name_error= $interests_error= $password_error= $signup_error= "";
		$error_status= 0;

		if(empty($fullname)){
			$fullname_error= "Please enter your Full Name";
			$error_status= 1;
		}
		if(empty($email)){
			$email_error= "Please enter a valid Email ID";
			$error_status= 1;
		}
		if(empty($phone)){
			$phone_error= "Please enter a valid Phone No";
			$error_status= 1;
		}
		if(empty($gender)){
			$gender_error= "Gender is mandatory";
			$error_status= 1;
		}
		if(empty($team_name)){
			$team_name_error= "Please enter your Team Name";
			$error_status= 1;
		}
		if(sizeof($interests)==0){
			$interests_error= "Please select one or more interests";
			$error_status= 1;
		}
		if(empty($password)){
			$password_error= "Password is required";
			$error_status= 1;
		}

		if($error_status==0){

			if(!preg_match("/^[".$name_pattern."]*$/",$fullname)){

				$fullname_error = "Only letters and white spaces";
				$error_status= 1;
			}

			if(!filter_var($email, FILTER_VALIDATE_EMAIL)){

				$email_error = "Invalid email format";
				$error_status= 1;
			}

			if(strlen($phone)!=10){

				$phone_error= "Must have 10 digits";
				$error_status= 1;
			}

			if(!preg_match("/^[".$phone_pattern."]*$/",$phone)){

				$phone_error = "Only digits from 0 to 9 allowed";
				$error_status= 1;
			}

			if(!preg_match("/^[".$team_name_pattern."]*$/",$team_name)){

				$team_name_error = "Only letters and digits";
				$error_status= 1;
			}

			if(preg_match("/\s/",$password)){

				$password_error = "Blank spaces are not allowed";
				$error_status= 1;
			}

			if(strlen($password)<8){

				$password_error= "Minimum 8 characters";
				$error_status= 1;
			}

			if($error_status==0){

				//convert interests into string

				$interests_string= "";
				foreach($interests as $interests_i){

					if($interests_string==""){
						$interests_string= $interests_i;
					}
					else{

						//if that interest doesn't already exist in the string
						if(strpos($interests_string, $interests_i)=== false){

							$interests_string= $interests_string.",".$interests_i;
						
						}
						
					}

				}

				//encrypt the password

				$password= hash("sha512", $password);

				//process the form

				//check if email and phone exists in the database

				$email_status= $phone_status= 0;

				$email_query_user= mysqli_query($connect_users,
					"SELECT * FROM user_details WHERE email='$email' "
					);
				if($email_query_user && $email_query_user->num_rows!=0){
					$email_status=1;
					$email_error= "Email ID already registered";
				}

				$phone_query_user= mysqli_query($connect_users,
					"SELECT * FROM user_details WHERE phone='$phone' "
					);
				if($phone_query_user && $phone_query_user->num_rows!=0){
					$phone_status=1;
					$phone_error= "Phone No already registered";
				}

				if($email_status==0 && $phone_status==0){

					//delete previous entries in user_temp with same email id and phone

					$delete_email= mysqli_query($connect_users,
						"DELETE FROM user_temp WHERE email='$email' "
						);
					$delete_phone= mysqli_query($connect_users,
						"DELETE FROM user_temp WHERE phone='$phone' "
						);

					//Email hashing
					
					function random_string($length) {
					    $key = '';
					    $keys = array_merge(range(0, 9), range('a', 'z'));
	
					    for ($i = 0; $i < $length; $i++) {
					        $key .= $keys[array_rand($keys)];
					    }
	
					    return $key;
					}
	
					$hash= random_string(50);
					$email_hash= hash("sha512", $hash);

					//enter the data into temporary database user_temp

					date_default_timezone_set("Asia/Kolkata");
					$date= date("d-m-Y");
					$time= date("h:i:sa");
					$timestamp= $date." ".$time;

					$insert_temp= mysqli_query($connect_users,
						"INSERT INTO user_temp VALUES ('','','$fullname','$email','$phone',
							'$gender','$team_name','$interests_string','$password','$email_hash',
							'$timestamp')"
						);
                    
                    
					//generate alcher id

					$user_id= mysqli_insert_id($connect_users);

					$fullname_trim= str_replace(" ", "", $fullname);
					$fullname_trim= str_replace("'", "", $fullname_trim);
					$fullname_trim= substr($fullname_trim, 0, 3);
					$fullname_trim= strtoupper($fullname_trim);

					$alcher_id= "ALC-".$fullname_trim."-".$user_id;

					$insert_alcher_id= mysqli_query($connect_users,
						"UPDATE user_temp SET alcher_id='$alcher_id' WHERE user_id='$user_id' "
						);
					

					if($insert_temp){

						$to= $email;
						$subject= "Activate your account at Alcheringa, IIT Guwahati";

						$email_welcome= "<p>Hi ".$fullname."</p>";

						$email_body= "<p>Thank you for registering at Alcheringa, IIT Guwahati.</p>";
						$email_body.= "<p>Your generated ALCHER ID is <strong>".$alcher_id."</strong>.</p>";
						$email_body.= "<p>One more step and you are good to go. Kindly activate your account by clicking the following link.</p>";
						$email_body.= "<br>";
						$email_body.= "<a href='http://www.alcheringa.in/registrations/verify.php?email=".$email."&hash=".$email_hash."&redirect=ca"."'>Activate Acount</a>";
						$email_body.= "<br>";
						$email_body.= "<p>If you are facing problem in the above link, copy and paste the following link in your web-browser.</p>";
						$email_body.= "<p>http://www.alcheringa.in/registrations/verify.php?email=".$email."&hash=".$email_hash."&redirect=ca</p>";
						$email_body.= "<br>";
						$email_body.= "<br>";

						$email_thankyou= "<p>-</p>";
						$email_thankyou.= "<p>Thank You</p>";
						$email_thankyou.= "<p>Team Alcheringa</p>";
						
						send_mail($to, $subject, $email_welcome, $email_body, $email_thankyou);

						$message = "Hi ".$fullname;

						$message .= "\n\nThank you for registering at Alcheringa, IIT Guwahati.";
						$message .= "\nYour generated ALCHER ID is ".$alcher_id.".";
						$message .= "\nAn activation mail has been to ".$email.". Kindly follow the procedure given to complete your signup process.";

						$message .= "\n\n-";
						$message .= "\nThank You";
						$message .= "\nTeam Alcheringa";

						send_sms($phone, $message);

						$_SESSION['email']= $email;
						header('Location: signup_process.php');

					}
					else{
						$signup_error= "Account could not be created. Please try again later.";
					}

				}

			}

		}

	}
?> -->
{% load static %}
<!DOCTYPE html>
<html>
<head>
	<title>Registration | Campus Ambassador | Alcheringa, IIT Guwahati</title>
	

	

	<meta name="description" content="Register now for competitions happening during Alcheringa, IIT Guwahati - one of the largest college cultural festivals in India.">
	<meta name="keywords" content="alcheringa,alcher,iit,guwahati,iitg,largest,cultural,festival,fest,india,competition,participant,participation,member,event,assam,northeast,2016,2017,2018,2019,january,february,rock,rocko,rock-o-phonix,rockophonix,rockophoenix,rock-o-phoenix,northeast rock,assam rock,battle,bands,thundermarch,silchar,Guwahati,Gauhati,dispur,weekender,kamakhya,mumbai,dance,music,fest,art,drama,prize,2.5 lacs,auditions,prelims,eliminations,holy,grail,metal,campus,ambassador,ca,date,release,31st Jan 2019 to 3rd Feb 2019,31st jan,3rd feb,2019 fest, city eliminations, auditions iitg, jaipur, delhi, lucknow, indore, pune, kolkata, shillong, jorhat, portal, electric,heels,electric heels,halla bol, halla,bol, monodrama,mono,so you think you can dance, sytycd, sutucd, alcher sutucd, theatrix, haute, couture,voguenation, vogue, nation, Glamour nova, glamour, nova, papyrus, array, crossfade, dj, dj battle, battle, faceoff,face, off, war, edm, electronic, music, roadies, fashion, games, informal, informals, class, apart, classapart, abcd, any body can dance, stagecraft, agt, Alcher got talent, step up, step, dancing duo, navras, raga high, high, raga, unplugged, voice of alcheringa, voice, choir, mun, model, united, nations, model united nations, model united nation, iitgmun, JAM, just a minute, mehfil, mehfil-e-alcheringa, parliamentary debate, iitg pd, iitgpd, pd, poetry, poetry slam, slam, clay, modelling, clay modelling, ink the tee, t-shirt, painting, t-shirt painting, Face art, face painting, graffiti, live sketching, sketching, rangoli, face art, football, futsal ,basketball, arm, arm wrestling, wrestling, gully cricket, cricket, gully, volleyball, online, competitions, digital, dexterity, custom, brush, doodle, pad, alcher diva, alcher hunk, xpressions, zephyr, lights, camera, action, directors cut, director, movie making, movie, short movie, snapthrillz, quiz, travel reimbursement, reaching iitg, accomodation, general, championship,  general championship, bounties, bounty">

	<meta property="og:url" content="http://www.alcheringa.in/registrations/index.php">
	<meta property="og:image" content="http://www.alcheringa.in/registrations/image.jpg">
	<meta property="og:description" content="Register now for competitions happening during Alcheringa, IIT Guwahati - one of the largest college cultural festivals in India.">
	<meta property="og:title" content="Registrations | Alcheringa, IIT Guwahati">
	<meta property="og:type" content="website">
	<meta property="og:site_name" content="Alcheringa, IIT Guwahati">
	<meta property="og:see_also" content="http://alcheringa.in">

	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:url" content="http://www.alcheringa.in/registrations/index.php">
	<meta name="twitter:title" content="Registrations | Alcheringa, IIT Guwahati">
	<meta name="twitter:description" content="Register now for competitions happening during Alcheringa, IIT Guwahati - one of the largest college cultural festivals in India.">
	<meta name="twitter:image" content="http://www.alcheringa.in/registrations/image.jpg">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="fontawesome/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="images/favicon.png" type="image/png" sizes="32x32">
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PPSHCGJ');</script>
<!-- End Google Tag Manager -->

    <style>
@import url('https://fonts.googleapis.com/css?family=Fira+Sans+Condensed');
        
        html,body{
        background-image: url('http://getwallpapers.com/wallpaper/full/6/e/b/90114.jpg');
        background-size: cover;
        background-repeat: no-repeat;
        height: 100%;
        font-family: 'Fira Sans Condensed', sans-serif;
        }
        
        .container{
        height: 100%;
        align-content: center;
        }
        
        .card{
        
        margin-top: auto;
        margin-bottom: auto;
        width: 400px;
        background-color: rgba(0,0,0,0.5) !important;
        }
        

* {
  box-sizing: border-box;
}

/* style the container */
.container {
  position: relative;
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 20px 0 30px 0;
  -webkit-box-shadow: 0 0 5px 2px #aaa;
    -moz-box-shadow: 0 0 5px 2px #aaa;
    box-shadow: 0 0 5px 2px #aaa;
} 

/* style inputs and link buttons */
input,
.btn {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 4px;
  margin: 5px 0 !important;
  opacity: 0.85;
  display: inline-block;
  font-size: 14px;
  line-height: 20px;

  text-decoration: none; /* remove underline from anchors */
}

input:hover,
.btn:hover {
  opacity: 1;
}

/* add appropriate colors to fb, twitter and google buttons */
.fb {
  background-color: #3B5998;
  color: white;
}

.twitter {
  background-color: #55ACEE;
  color: white;
}

.google {
  background-color: #dd4b39;
  color: white;
}

/* style the submit button */
#ca_login_button {
  background-color: #1A73E8;
  color: white;
  cursor: pointer;
}

#ca_login_button:hover {
  background-color: #1c61bd;
}

/* Two-column layout */
.col {
  float: left;
  width: 50%;
  margin: auto;
  padding: 0 50px;
  margin-top: 6px;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

/* vertical line */
.vl {
  position: absolute;
  left: 50%;
  transform: translate(-50%);
  border: 2px solid #ddd;
  height: 175px;
}

/* text inside the vertical line */
.vl-innertext {
  position: absolute;
  top: 50%;
  transform: translate(-50%, -50%);
  background-color: #f1f1f1;
  border: 1px solid #ccc;
  border-radius: 50%;
  padding: 8px 10px;
  width: auto;
}

/* hide some text on medium and large screens */
.hide-md-lg {
  display: none;
}

/* bottom container */
.bottom-container {
  text-align: center;
  background-color: #666;
  border-radius: 0px 0px 4px 4px;
}

/* Responsive layout - when the screen is less than 650px wide, make the two columns stack on top of each other instead of next to each other */
@media screen and (max-width: 650px) {
  .col {
    width: 100%;
    margin-top: 0;
  }
  /* hide the vertical line */
  .vl {
    display: none;
  }
  /* show the hidden text on small screens */
  .hide-md-lg {
    display: block;
    text-align: center;
  }
}
.ca_login_email_error {
    display: none;
    font-size:11px;
    color:#d50000;
}

.ca_login_password_error {
    display: none;
    font-size:11px;
    color:#d50000;
}
.email_error_input_error{
    font-size:11px;
    color:#d50000;
}
.password_error_input_error{
    font-size:11px;
    color:#d50000;
}

</style>
<link rel="stylesheet" href="{% static 'ca/css/style.css' %}">
  <link rel="stylesheet" href="{% static 'ca/css/index.css' %}">
  <link rel="stylesheet" href="{% static 'ca/css/font-awesome.min.css' %}">
  <link rel="stylesheet" href="{% static 'ca/css/Roboto.css' %}">
  <link rel="stylesheet" href="{% static 'ca/css/normalize.css' %}">
  	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  	<link href="https://fonts.googleapis.com/css?family=Fira+Sans|Roboto" rel="stylesheet">
  	<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-green.min.css">
  	<link rel="stylesheet" href="{% static 'ca/semantic/dist/semantic.min.css' %}">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>



</head>
<body style="
    background: #942c2c;
    background: linear-gradient(to bottom right, #942c2c, #762a77);
    ">
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PPSHCGJ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
	<header class="w3-bar w3-black" style="max-height: 80px; box-shadow:0 3px 9px 0 rgba(0,0,0,0.10), 0 0 0 1px rgba(0,0,0,0.04);font:13px/27px 'Roboto','RobotoDraft',Arial,sans-serif;-webkit-box-shadow:0 3px 9px 0 rgba(0,0,0,0.10), 0 0 0 1px rgba(0,0,0,0.04);transition: box-shadow 250ms;color: #757575;padding-top:3px;padding-bottom:3px;padding-left: 24px;padding-right: 24px;white-space: nowrap;">
  <a href="https://www.alcheringa.in/" alt="Alcheringa" style='padding:0;margin:0;'>
      <img src="images/avatar3.png" style="width: 158px !important;height:74px !important;display: block;" ></a>
</header>

<div style="margin-left: auto;margin-right: auto;max-width: 800px;margin-top:10px;">
                        
<div class="container">
  
    <div class="row">
    	 {% if messages %}
        {% for message in messages %}
         {% if message.tags %}  <script>alert("{{ message }}")</script> {% endif %}

        {% endfor %}

    {% endif %}
      <h4 style="text-align:center;text-transform:uppercase">Campus Ambassador Portal</h4>
      
      <div style="max-width:320px;padding:0 5px 0 5px;margin-left:auto;margin-right:auto;">
      <p style="color:#767676;direction:ltr">Campus ambassadors are our representatives in your college. Work with us to make <b style='color:#000'>Alcheringa</b> bigger and better.</p>
      <br>
      </div>
      
      <div class="vl">
        <span class="vl-innertext">or</span>
      </div>

      <div class="col">
                        
        
      </div>

      <div class="col">
        <div class="hide-md-lg">
          <p>Or sign up manually:</p>
          
        </div>
        <div class="sign_up_error" style="color:#d50000;font-size:11px;">
			{{signup_error}}
						
	    </div>
        
        
        <form id='create_account_form' action='' method='POST'>
            {% csrf_token %}

							

							<div class="phone_div">

								<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
									<input class="mdl-textfield__input" type="tel" id="phone" name="phone"
									value="" pattern="{{phone_pattern}}">
									<label class="mdl-textfield__label" for="phone">Phone Number</label>
									<span class="mdl-textfield__error">Please enter a valid Phone No</span>
								</div>

								<div class="phone_error input_error"><p>{{phone_error}}</p></div>

							</div>

							<div class="gender_div">
								<label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="gender_male">
									<input type="radio" id="gender_male" class="mdl-radio__button" name="gender"
									value="M">
									<span class="mdl-radio__label">Male</span>
								</label>
								<label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="gender_female">
									<input type="radio" id="gender_female" class="mdl-radio__button" name="gender"
									value="F">
									<span class="mdl-radio__label">Female</span>
								</label>

								<div class="gender_error input_error"><p>{{gender_error}}</p></div>
							</div>

							<div class="team_name_div">

								<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
									<input class="mdl-textfield__input" type="text" id="team_name" name="team_name"
										value="" pattern="{{team_name_pattern}}">
									<label class="mdl-textfield__label" for="team_name">College/Institute/Team Name</label>
									<span class="mdl-textfield__error">Only letters, digits, comma and space are allowed</span>
								</div>

								<div class="team_name_error input_error"><p>{{team_name_error}}</p></div>

							</div>

							<div class="interests_div">
								Pick Your Interests
								<select name='interests[]' form='create_account_form' multiple id='interests' class="ui fluid search dropdown">
									
									{% for interest in interests_list %}
									<option value='{{interest.id}}'>{{interest.name}}</option>
									{% endfor %}

								</select>

								<div class="interests_error input_error"><p>{{interests_error}}</p></div>
							</div>

							

							<div class="sign_up">
							    <button style="" name="create_account" id="ca_login_button" class="btn">CREATE ACCOUNT</button>
								
							</div>

		</form>
        <!-- -->
      
      </div>
      
    </div>
  
  
</div>

<div class="bottom-container">
  <div class="row">
    <div class="col">
      <a href="{% url 'auths:login' %}" style="color:white" class="btn">Login </a>
    </div>
    
  </div>
</div>
</div>
					
<script>
    





</script>
    
    <script type="text/javascript" src="{% static 'ca/js/jquery.js' %}"></script>
	<script type="text/javascript" src="{% static 'ca/js/drawer.js' %}"></script>
	<script type="text/javascript" src="{% static 'ca/js/functions.js' %}"></script>
	<script type="text/javascript" src="{% static 'ca/js/jquery_ui/jquery-ui.min.js' %}"></script>
	<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
	<script type="text/javascript" src="{% static 'ca/semantic/dist/semantic.min.js' %}"></script>
	<script type="text/javascript">
		$(function(){
			$('#interests').dropdown();

			$('.login_form_slider').click(function(){
				var $this= $(this);
				$this.parent().slideUp(function(){
					$this.parent().next().slideDown();
				});
				
			});

			$('#sign_up_button').click(function(){
				$('.login_div').slideUp(function(){
					$('.sign_up_div').slideDown();
				});
				$('#sign_up_button').animate({'background-color': '#2abfbf', 'color': 'white'}, 400);
				$('#login_button').animate({'background-color': 'white', 'color': '#2abfbf'}, 400);
			});
			$('#login_button').click(function(){
				$('.sign_up_div').slideUp(function(){
					$('.login_div').slideDown();
					$('.login_div').css({'display': 'flex'});
				});
				$('#login_button').animate({'background-color': '#2abfbf', 'color': 'white'}, 400);
				$('#sign_up_button').animate({'background-color': 'white', 'color': '#2abfbf'}, 400);
			});
			
		});
	</script>
					
					
</body>
</html>